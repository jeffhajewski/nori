context_version: 1
module: dashboard
goal: "Real-time animated UI for elections, storage, compaction, shards."
status: implemented

services:
  vizd:
    description: "Telemetry/VizEvent aggregator & websocket/gRPC-web bridge."
    location: "apps/norikv-vizd"
    port: 9090
    endpoints:
      - "/ws/events": "WebSocket event stream (JSON or MessagePack)"
      - "/api/history": "Query historical events by time range"
      - "/api/stats": "Server statistics"
      - "/health": "Health check"

  dashboard:
    description: "Next.js React dashboard for cluster visualization."
    location: "apps/norikv-dashboard"
    port: 3001
    stack: "Next.js 14 + React 18 + Tailwind + Zustand + Framer Motion"

frontend:
  stack: "Next.js 14 (App Router) + React 18 + Tailwind CSS + Zustand + Framer Motion"
  routes:
    - "/": "Cluster overview - health stats, node grid, shard leaders, write pressure"
    - "/storage": "LSM heatmap, compaction conveyor belt, write pressure gauge"
    - "/consensus": "Shard leadership grid, election timeline, term tracking"
    - "/network": "SWIM topology ring, node status, membership events"
    - "/shards": "Shard placement, replica distribution, shard details"
    - "/events": "Real-time event stream with type filtering"
  features:
    - "Dark/light theme toggle"
    - "Mock event generator for development"
    - "WebSocket reconnection with exponential backoff"
    - "Event filtering by type, node, shard"
    - "Animated visualizations (Framer Motion)"

event_types:
  - Wal: "Segment roll, fsync, GC, corruption"
  - Compaction: "Scheduled, start, progress, finish, bandit selection/reward"
  - Lsm: "Flush, L0 stall, write pressure, guard adjustment"
  - Raft: "Leader elected, vote req/granted, step down"
  - Swim: "Alive, suspect, confirm, leave"
  - Shard: "Plan, snapshot, cutover"
  - Cache: "Hit ratio updates"
  - SlotHeat: "LSM slot temperature tracking"

performance_budgets:
  ws_updates_fps: 20
  coalesce_window_ms: 50
  bw_per_client_kbps: 150
  ring_buffer_minutes: 60

modes:
  - dev_mock: "Mock events generated client-side (NEXT_PUBLIC_USE_MOCK=true)"
  - dev_vizd: "Connect to local vizd (NEXT_PUBLIC_USE_MOCK=false)"
  - prod: "Sampled events from production cluster"

quickstart: |
  # Run with mock events (no backend required)
  cd apps/norikv-dashboard
  npm install
  npm run dev
  # Open http://localhost:3001

  # Run with vizd backend
  cd apps/norikv-vizd && cargo run &
  cd apps/norikv-dashboard
  NEXT_PUBLIC_USE_MOCK=false npm run dev
